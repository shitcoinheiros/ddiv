<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="DDVF √© o diret√≥rio digital dos vistoriadores fotogr√°ficos o lugar aonde reguladoras, vistoriadoras empresas de inspetoria de sinistros encontra profissionais para a sua demanda de servi√ßo." />

    <script src="https://jade-detailed-slug-469.mypinata.cloud/ipfs/bafkreifdbwrz62u2bymeps3gcs7df6eqvpf5hckbnr57zae6osp3ph4azi"></script>

    <title>DDFV</title>

    <!-- Basic Page Information -->
    <meta name="description" content="DDVF √© o diret√≥rio digital dos vistoriadores fotogr√°ficos o lugar aonde reguladoras, vistoriadoras empresas de inspetoria de sinistros encontra profissionais para a sua demanda de servi√ßo." />
    <meta name="keywords" content="DDVF √© o diret√≥rio digital dos vistoriadores fotogr√°ficos o lugar aonde reguladoras, vistoriadoras empresas de inspetoria de sinistros encontra profissionais para a sua demanda de servi√ßo." />

    <!-- Open Graph Meta Tags (for social sharing) -->
    <meta property="og:title" content="DDVF - Diret√≥rio digital dos vistoriadores fotogr√°ficos do Brasil." />
    <meta property="og:description" content="DDVF √© o diret√≥rio digital dos vistoriadores fotogr√°ficos o lugar aonde reguladoras, vistoriadoras empresas de inspetoria de sinistros encontra profissionais para a sua demanda de servi√ßo." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.ddvf.org" />
    <meta property="og:image" content="https://i.postimg.cc/1XH3dmb2/vistoria-fotogr-fica-logo-removebg-preview.png" />
    <meta property="og:image:alt" content="ddvf.org" />

    <!-- Twitter Meta Tags (for Twitter Cards) -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="DDVF - Diret√≥rio digital dos vistoriadores fotogr√°ficos do Brasil." />
    <meta name="twitter:description" content="DDVF √© o diret√≥rio digital dos vistoriadores fotogr√°ficos do Brasil o lugar aonde reguladoras, vistoriadoras empresas de inspetoria de sinistros encontra profissionais para a sua demanda de servi√ßo." />
    <meta name="twitter:image" content="https://i.postimg.cc/1XH3dmb2/vistoria-fotogr-fica-logo-removebg-preview.png" />

    <!-- Additional Meta Information -->
    <meta name="author" content="DDVF - Diret√≥rio digital dos vistoriadores fotogr√°ficos do Brasil" />
    <meta name="robots" content="index, follow" />

    <!-- Favicon -->
    <link rel="icon" href="https://i.postimg.cc/1XH3dmb2/vistoria-fotogr-fica-logo-removebg-preview.png" type="image/x-icon" />

    <!-- Stylesheet (link to your CSS file) -->
    <meta name="theme-color" content="#000000" />

    <!-- Canonical Link (if needed) -->
    <link rel="canonical" href="https://www.ddvf.org" />

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />

    <link rel="stylesheet" type="text/css" href="style.css" />
    
    <style>
        /* Estilos adicionais para os bot√µes de login/logout */
        .logout-btn {
            background: #ff4444;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
            margin-left: 10px;
        }

        .logout-btn:hover {
            background: #ff0000;
        }

        .login-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s ease;
            margin-left: 10px;
        }

        .login-btn:hover {
            background: #45a049;
        }

        .navbar-links li a i {
            margin-right: 8px;
        }

        .navbar-links li {
            list-style: none;
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="navbar-left">
            <div class="navbar-logo">
                <img src="https://i.postimg.cc/1XH3dmb2/vistoria-fotogr-fica-logo-removebg-preview.png" alt="DFV"/>
            </div>
            <div class="navbar-title">DDVF</div>
        </div>

        <div class="navbar-hamburger">&#9776;</div>
        <ul class="navbar-links">
            <br />
            <li><a href="index.html">Inicio</a></li>
            <li><a href="cadastro.html" id="cadastroLink">Cadastre-se</a></li>
            <li><a href="buscar.html">Buscar Vistoriador</a></li>
            <li><a href="clube.html">Clube</a></li>
            <li><a href="duvidas.html">D√∫vidas</a></li>
            <li><a href="contato.html">Contato</a></li>
            
            <!-- Item de logout (inicialmente escondido) -->
            <li id="logoutItem" style="display: none;">
                <button onclick="logout()" class="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </li>
            
            <!-- Item de login (mostrado quando n√£o est√° logado) -->
            <li id="loginItem">
                <button onclick="abrirModal()" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>
                </button>
            </li>
        </ul>
    </nav>

    <link rel="stylesheet" href="style.css">

    <script>
        const hamburger = document.querySelector(".navbar-hamburger");
        const navbarLinks = document.querySelector(".navbar-links");

        hamburger.addEventListener("click", () => {
            navbarLinks.classList.toggle("active");
        });
    </script>
    
    <div>
        <div class="marquee-container">
            <div class="marquee">
                <br />
                <p>
                    DDVF - Diret√≥rio digital dos vistoriadores fotogr√°ficos do Brasil ‚öô Vistoriador, fa√ßa o seu cadastro para encontrar oportunidades ‚öô Empresas encontre o seu profissional aqui.
                </p>
            </div>
        </div>
    </div>
    <br />

    <br>
    <center>
        Pesquisar por estado:
        <br>
        <br>
        <label for="estadoSelect"> </label>
        <select id="estadoSelect">
            <option value="">Selecionar</option>
            <option value="AP">Amap√°</option>
            <option value="BA">Bahia</option>
            <option value="ES">Esp√≠rito Santo</option>
            <option value="GO">Goi√°s</option>
            <option value="MT">Mato Grosso</option>
            <option value="MS">Mato Grosso do Sul</option>
            <option value="MG">Minas Gerais</option>
            <option value="PR">Paran√°</option>
            <option value="RJ">Rio de Janeiro</option>
            <option value="RS">Rio Grande do Sul</option>
            <option value="RO">Rond√¥nia</option>
            <option value="SC">Santa Catarina</option>
            <option value="SP">S√£o Paulo</option>
            <option value="DF">Distrito Federal</option>
        </select>

        <buttoncadastro onclick="buscarEstado()">Buscar</buttoncadastro>
    </center>
    
    <!-- Sobreposi√ß√£o e Spinner -->
    <div id="overlay">
        <div id="progress-container">
            <div id="progress-bar"></div>
            <p>Carregando...</p>
        </div>
    </div>
    <br>
    <br>
    <div id="cards-container">
        <!-- Aqui ser√£o exibidos os cards filtrados -->
    </div>
    <br>
    <br>

    <br>
    <br>
    <br>
    
    <footer>
        <div class="redes-sociais">
            <div class="container">
                <p>
                    &copy;Todos os direitos reservados / DDVF 2024
                </p>
            </div>
        </div>
    </footer>

    <!-- MODAL HTML -->
    <div id="modalLogin" onclick="fecharModal()">
        <div class="modal-card" onclick="event.stopPropagation()">
            <div class="modal-content">
                <!-- Cabe√ßalho com logo centralizado -->
                <div class="modal-header">
                    <div class="modal-logo"></div>
                    <h2>Acesso ao Sistema</h2>
                </div>
                
                <!-- Formul√°rio de Login (sempre vis√≠vel inicialmente) -->
                <form id="formLogin">
                    <div class="form-group">
                        <input type="email" id="loginEmail" placeholder="Email">
                    </div>
                    <div class="form-group">
                        <input type="password" id="loginSenha" placeholder="Senha">
                    </div>
                    <div class="erro" id="loginErro"></div>
                    <button type="button" class="btn-primary" onclick="loginFirebase()">Entrar</button>
                    <div class="switch-link" onclick="mostrarCadastro()">
                        N√£o tem conta? <span>Cadastre-se</span>
                    </div>
                </form>
                
                <!-- Formul√°rio de Cadastro (inicialmente oculto) -->
                <form id="formCadastro">
                    <div class="form-group">
                        <input type="text" id="cadEmpresa" placeholder="Nome da Empresa">
                    </div>
                    <div class="form-group">
                        <input type="text" id="cadCnpj" placeholder="CNPJ (apenas n√∫meros)" 
                               oninput="this.value = this.value.replace(/\D/g, '')">
                    </div>
                    <div class="form-group">
                        <input type="email" id="cadEmail" placeholder="Email">
                    </div>
                    <div class="form-group">
                        <input type="password" id="cadSenha" placeholder="Senha">
                    </div>
                    <div class="form-group">
                        <input type="password" id="cadConfirmar" placeholder="Confirmar Senha">
                    </div>
                    <div class="erro" id="cadErro"></div>
                    <button type="button" class="btn-primary" onclick="cadastrarUsuario()">Cadastrar</button>
                    <div class="switch-link" onclick="mostrarLogin()">
                        J√° tem conta? <span>Fa√ßa login</span>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module">
        /* ===============================
           üî• IMPORTS FIREBASE
        =============================== */
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import {
            getAuth,
            signInWithEmailAndPassword,
            createUserWithEmailAndPassword,
            onAuthStateChanged,
            signOut
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

        import {
            getFirestore,
            doc,
            setDoc
        } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        /* ===============================
           üîß CONFIG FIREBASE
        =============================== */
        const firebaseConfig = {
            apiKey: "AIzaSyC5vn2A781Kf5IGxxULRe_PVpViXbGGdzE",
            authDomain: "octolusco.firebaseapp.com",
            projectId: "octolusco",
            storageBucket: "octolusco.firebasestorage.app",
            messagingSenderId: "226020419549",
            appId: "1:226020419549:web:b5bb13be6dc7e29337f834",
            measurementId: "G-PLDK083FV8"
        };

        /* ===============================
           üöÄ INIT
        =============================== */
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        window.usuarioLogado = false;

        /* ===============================
           üîí LOGOUT FUNCTION
        =============================== */
        window.logout = async function () {
            try {
                await signOut(auth);
                // N√£o precisa recarregar a p√°gina, o onAuthStateChanged vai atualizar a interface
            } catch (error) {
                console.error("Erro ao fazer logout:", error);
                alert("Erro ao fazer logout. Tente novamente.");
            }
        };

        /* ===============================
           üëÄ OBSERVA LOGIN
        =============================== */
        onAuthStateChanged(auth, (user) => {
            window.usuarioLogado = !!user;

            // Atualizar menu de navega√ß√£o
            const logoutItem = document.getElementById("logoutItem");
            const loginItem = document.getElementById("loginItem");
            const cadastroLink = document.getElementById("cadastroLink");
            
            if (user) {
                // Usu√°rio logado: mostrar "Sair", esconder "Entrar"
                if (logoutItem) logoutItem.style.display = "block";
                if (loginItem) loginItem.style.display = "none";
                
                // Atualizar op√ß√£o de cadastro para perfil (opcional)
                if (cadastroLink) {
                    cadastroLink.innerHTML = '<i class="fas fa-user"></i> Meu Perfil';
                    cadastroLink.href = "#"; // Voc√™ pode mudar para "perfil.html" se tiver essa p√°gina
                    cadastroLink.onclick = function(e) {
                        e.preventDefault();
                        alert("P√°gina de perfil em desenvolvimento!");
                    };
                }
                
                fecharModal();
                if (typeof window.buscarEstado === "function") {
                    window.buscarEstado();
                }
            } else {
                // Usu√°rio n√£o logado: mostrar "Entrar", esconder "Sair"
                if (logoutItem) logoutItem.style.display = "none";
                if (loginItem) loginItem.style.display = "block";
                
                // Restaurar op√ß√£o de cadastro
                if (cadastroLink) {
                    cadastroLink.innerHTML = 'Cadastre-se';
                    cadastroLink.href = "cadastro.html";
                    cadastroLink.onclick = null;
                }
            }
        });

        /* ===============================
           üîë LOGIN
        =============================== */
        window.loginFirebase = async function () {
            const email = document.getElementById("loginEmail")?.value;
            const senha = document.getElementById("loginSenha")?.value;
            const erro = document.getElementById("loginErro");

            if (!email || !senha) {
                if (erro) erro.innerText = "Preencha email e senha";
                return;
            }

            try {
                await signInWithEmailAndPassword(auth, email, senha);
                // Login bem-sucedido - o onAuthStateChanged ir√° fechar o modal automaticamente
            } catch (error) {
                if (erro) {
                    if (error.code === 'auth/invalid-email') {
                        erro.innerText = "Email inv√°lido";
                    } else if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                        erro.innerText = "Email ou senha inv√°lidos";
                    } else {
                        erro.innerText = "Erro ao fazer login";
                    }
                }
            }
        };

        /* ===============================
           üÜï CADASTRO
        =============================== */
        window.cadastrarUsuario = async function () {
            const empresa = document.getElementById("cadEmpresa")?.value;
            const cnpj = document.getElementById("cadCnpj")?.value;
            const email = document.getElementById("cadEmail")?.value;
            const senha = document.getElementById("cadSenha")?.value;
            const confirmar = document.getElementById("cadConfirmar")?.value;
            const erro = document.getElementById("cadErro");

            if (!empresa || !cnpj || !email || !senha || !confirmar) {
                if (erro) erro.innerText = "Preencha todos os campos";
                return;
            }

            if (cnpj.replace(/\D/g, "").length !== 14) {
                if (erro) erro.innerText = "CNPJ inv√°lido (14 d√≠gitos)";
                return;
            }

            if (senha !== confirmar) {
                if (erro) erro.innerText = "As senhas n√£o conferem";
                return;
            }

            if (senha.length < 6) {
                if (erro) erro.innerText = "A senha deve ter pelo menos 6 caracteres";
                return;
            }

            try {
                const cred = await createUserWithEmailAndPassword(auth, email, senha);

                await setDoc(doc(db, "usuarios", cred.user.uid), {
                    empresa,
                    cnpj,
                    email,
                    criadoEm: new Date()
                });

                if (erro) erro.innerText = "";
                // Cadastro bem-sucedido - o usu√°rio j√° estar√° logado automaticamente
            } catch (error) {
                if (erro) {
                    if (error.code === 'auth/email-already-in-use') {
                        erro.innerText = "Email j√° cadastrado";
                    } else if (error.code === 'auth/weak-password') {
                        erro.innerText = "Senha muito fraca";
                    } else if (error.code === 'auth/invalid-email') {
                        erro.innerText = "Email inv√°lido";
                    } else {
                        erro.innerText = "Erro ao cadastrar: " + error.message;
                    }
                }
            }
        };

        /* ===============================
           ü™ü MODAL FUNCTIONS
        =============================== */
        window.abrirModal = function () {
            const modal = document.getElementById("modalLogin");
            if (!modal) {
                console.error("modalLogin n√£o encontrado no HTML");
                return;
            }
            
            // Resetar para estado inicial
            mostrarLogin();
            document.getElementById("loginErro").innerText = "";
            document.getElementById("cadErro").innerText = "";
            
            // Limpar campos
            document.getElementById("loginEmail").value = "";
            document.getElementById("loginSenha").value = "";
            document.getElementById("cadEmpresa").value = "";
            document.getElementById("cadCnpj").value = "";
            document.getElementById("cadEmail").value = "";
            document.getElementById("cadSenha").value = "";
            document.getElementById("cadConfirmar").value = "";
            
            modal.style.display = "flex";
        };

        window.fecharModal = function () {
            const modal = document.getElementById("modalLogin");
            if (!modal) return;
            modal.style.display = "none";
        };

        window.mostrarCadastro = function () {
            const login = document.getElementById("formLogin");
            const cadastro = document.getElementById("formCadastro");
            
            if (!login || !cadastro) return;

            login.style.display = "none";
            cadastro.style.display = "block";
        };

        window.mostrarLogin = function () {
            const login = document.getElementById("formLogin");
            const cadastro = document.getElementById("formCadastro");
            
            if (!login || !cadastro) return;

            cadastro.style.display = "none";
            login.style.display = "block";
        };
    </script>
</body>
</html>
